function ownKeys(t,e){var r,i=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,r)),i}function _objectSpread2(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(r),!0).forEach(function(e){_defineProperty(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,_toPropertyKey(i.key),i)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _defineProperty(e,t,r){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _extends(){return(_extends=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r,i=arguments[t];for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}).apply(this,arguments)}function _toPrimitive(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);r=r.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==typeof e?e:String(e)}var canvasToBlob={exports:{}},toBlob=(!function(e){var t,a,s,l,c,u,o;"undefined"!=typeof window&&(a=(t=window).HTMLCanvasElement&&t.HTMLCanvasElement.prototype,s=t.Blob&&function(){try{return Boolean(new Blob)}catch(e){return!1}}(),l=s&&t.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(e){return!1}}(),c=t.BlobBuilder||t.WebKitBlobBuilder||t.MozBlobBuilder||t.MSBlobBuilder,u=/^data:((.*?)(;charset=.*?)?)(;base64)?,/,o=(s||c)&&t.atob&&t.ArrayBuffer&&t.Uint8Array&&function(e){var t,r,i,a,o,n=e.match(u);if(!n)throw new Error("invalid data URI");for(t=n[2]?n[1]:"text/plain"+(n[3]||";charset=US-ASCII"),o=!!n[4],e=e.slice(n[0].length),r=(o?atob:decodeURIComponent)(e),n=new ArrayBuffer(r.length),i=new Uint8Array(n),a=0;a<r.length;a+=1)i[a]=r.charCodeAt(a);return s?new Blob([l?i:n],{type:t}):((o=new c).append(n),o.getBlob(t))},t.HTMLCanvasElement&&!a.toBlob&&(a.mozGetAsFile?a.toBlob=function(e,t,r){var i=this;setTimeout(function(){r&&a.toDataURL&&o?e(o(i.toDataURL(t,r))):e(i.mozGetAsFile("blob",t))})}:a.toDataURL&&o&&(a.msToBlob?a.toBlob=function(e,t,r){var i=this;setTimeout(function(){(t&&"image/png"!==t||r)&&a.toDataURL&&o?e(o(i.toDataURL(t,r))):e(i.msToBlob(t))})}:a.toBlob=function(e,t,r){var i=this;setTimeout(function(){e(o(i.toDataURL(t,r)))})})),e.exports?e.exports=o:t.dataURLtoBlob=o)}(canvasToBlob),canvasToBlob.exports),isBlob=function(e){return"undefined"!=typeof Blob&&(e instanceof Blob||"[object Blob]"===Object.prototype.toString.call(e))},DEFAULTS={strict:!0,checkOrientation:!0,retainExif:!1,maxWidth:1/0,maxHeight:1/0,minWidth:0,minHeight:0,width:void 0,height:void 0,resize:"none",quality:.8,mimeType:"auto",convertTypes:["image/png"],convertSize:5e6,beforeDraw:null,drew:null,success:null,error:null},IS_BROWSER="undefined"!=typeof window&&void 0!==window.document,WINDOW=IS_BROWSER?window:{},isPositiveNumber=function(e){return 0<e&&e<1/0},slice=Array.prototype.slice;function toArray(e){return Array.from?Array.from(e):slice.call(e)}var REGEXP_IMAGE_TYPE=/^image\/.+$/;function isImageType(e){return REGEXP_IMAGE_TYPE.test(e)}function imageTypeToExtension(e){e=isImageType(e)?e.substr(6):"";return".".concat(e="jpeg"===e?"jpg":e)}var fromCharCode=String.fromCharCode;function getStringFromCharCode(e,t,r){var i,a="";for(r+=t,i=t;i<r;i+=1)a+=fromCharCode(e.getUint8(i));return a}var btoa=WINDOW.btoa;function arrayBufferToDataURL(e,t){for(var r=[],i=new Uint8Array(e);0<i.length;)r.push(fromCharCode.apply(null,toArray(i.subarray(0,8192)))),i=i.subarray(8192);return"data:".concat(t,";base64,").concat(btoa(r.join("")))}function resetAndGetOrientation(e){var t,r,i,a,o,n,s,l=new DataView(e);try{if(255===l.getUint8(0)&&216===l.getUint8(1))for(var c=l.byteLength,u=2;u+1<c;){if(255===l.getUint8(u)&&225===l.getUint8(u+1)){r=u;break}u+=1}if(r&&(a=r+10,"Exif"!==getStringFromCharCode(l,r+4,4)||!(s=18761===(o=l.getUint16(a)))&&19789!==o||42===l.getUint16(a+2,s)&&8<=(n=l.getUint32(a+4,s))&&(i=a+n)),i)for(var h,f=l.getUint16(i,s),d=0;d<f;d+=1)if(h=i+12*d+2,274===l.getUint16(h,s)){h+=8,t=l.getUint16(h,s),l.setUint16(h,1,s);break}}catch(e){t=1}return t}function parseOrientation(e){var t=0,r=1,i=1;switch(e){case 2:r=-1;break;case 3:t=-180;break;case 4:i=-1;break;case 5:t=90,i=-1;break;case 6:t=90;break;case 7:t=90,r=-1;break;case 8:t=-90}return{rotate:t,scaleX:r,scaleY:i}}var REGEXP_DECIMALS=/\.\d*(?:0|9){12}\d*$/;function normalizeDecimalNumber(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1e11;return REGEXP_DECIMALS.test(e)?Math.round(e*t)/t:e}function getAdjustedSizes(e){var t,r=e.aspectRatio,i=e.height,a=e.width,o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"none",n=isPositiveNumber(a),s=isPositiveNumber(i);return n&&s?(t=i*r,("contain"===o||"none"===o)&&a<t||"cover"===o&&t<a?i=a/r:a=i*r):n?i=a/r:s&&(a=i*r),{width:a,height:i}}function getExif(e){for(var t=toArray(new Uint8Array(e)),r=t.length,i=[],a=0;a+3<r;){var o=t[a],n=t[a+1];if(255===o&&218===n)break;255===o&&216===n?a+=2:(o=a+(256*t[a+2]+t[a+3])+2,n=t.slice(a,o),i.push(n),a=o)}return i.reduce(function(e,t){return 255===t[0]&&225===t[1]?e.concat(t):e},[])}function insertExif(e,t){var r=toArray(new Uint8Array(e));if(255!==r[2]||224!==r[3])return e;e=256*r[4]+r[5],t=[255,216].concat(t,r.slice(4+e));return new Uint8Array(t)}var ArrayBuffer$1=WINDOW.ArrayBuffer,FileReader=WINDOW.FileReader,URL=WINDOW.URL||WINDOW.webkitURL,REGEXP_EXTENSION=/\.\w+$/,AnotherCompressor=WINDOW.Compressor,Compressor=function(){function r(e,t){_classCallCheck(this,r),this.file=e,this.exif=[],this.image=new Image,this.options=_objectSpread2(_objectSpread2({},DEFAULTS),t),this.aborted=!1,this.result=null,this.init()}return _createClass(r,[{key:"init",value:function(){var i,a,o,e,n=this,s=this.file,t=this.options;isBlob(s)?isImageType(i=s.type)?URL&&FileReader?(ArrayBuffer$1||(t.checkOrientation=!1,t.retainExif=!1),a=(e="image/jpeg"===i)&&t.checkOrientation,o=e&&t.retainExif,!URL||a||o?(e=new FileReader,(this.reader=e).onload=function(e){var e=e.target.result,t={},r=1;a&&1<(r=resetAndGetOrientation(e))&&_extends(t,parseOrientation(r)),o&&(n.exif=getExif(e)),t.url=a||o?!URL||1<r?arrayBufferToDataURL(e,i):URL.createObjectURL(s):e,n.load(t)},e.onabort=function(){n.fail(new Error("Aborted to read the image with FileReader."))},e.onerror=function(){n.fail(new Error("Failed to read the image with FileReader."))},e.onloadend=function(){n.reader=null},a||o?e.readAsArrayBuffer(s):e.readAsDataURL(s)):this.load({url:URL.createObjectURL(s)})):this.fail(new Error("The current browser does not support image compression.")):this.fail(new Error("The first argument must be an image File or Blob object.")):this.fail(new Error("The first argument must be a File or Blob object."))}},{key:"load",value:function(e){var t=this,r=this.file,i=this.image;i.onload=function(){t.draw(_objectSpread2(_objectSpread2({},e),{},{naturalWidth:i.naturalWidth,naturalHeight:i.naturalHeight}))},i.onabort=function(){t.fail(new Error("Aborted to load the image."))},i.onerror=function(){t.fail(new Error("Failed to load the image."))},WINDOW.navigator&&/(?:iPad|iPhone|iPod).*?AppleWebKit/i.test(WINDOW.navigator.userAgent)&&(i.crossOrigin="anonymous"),i.alt=r.name,i.src=e.url}},{key:"draw",value:function(e){var a=this,o=e.naturalWidth,n=e.naturalHeight,t=e.rotate,t=void 0===t?0:t,r=e.scaleX,r=void 0===r?1:r,e=e.scaleY,e=void 0===e?1:e,i=this.file,s=this.image,l=this.options,c=document.createElement("canvas"),u=c.getContext("2d"),h=Math.abs(t)%180==90,f=("contain"===l.resize||"cover"===l.resize)&&isPositiveNumber(l.width)&&isPositiveNumber(l.height),d=Math.max(l.maxWidth,0)||1/0,m=Math.max(l.maxHeight,0)||1/0,b=Math.max(l.minWidth,0)||0,p=Math.max(l.minHeight,0)||0,g=o/n,y=l.width,w=l.height,v=(h&&(d=(v=[m,d])[0],m=v[1],b=(v=[p,b])[0],p=v[1],y=(v=[w,y])[0],w=v[1]),getAdjustedSizes({aspectRatio:g=f?y/w:g,width:d,height:m},"contain")),v=(d=v.width,m=v.height,getAdjustedSizes({aspectRatio:g,width:b,height:p},"cover")),v=(b=v.width,p=v.height,w=f?(y=(v=getAdjustedSizes({aspectRatio:g,width:y,height:w},l.resize)).width,v.height):(y=void 0===(E=(v=getAdjustedSizes({aspectRatio:g,width:y,height:w})).width)?o:E,void 0===(E=v.height)?n:E),-(y=Math.floor(normalizeDecimalNumber(Math.min(Math.max(y,b),d))))/2),E=-(w=Math.floor(normalizeDecimalNumber(Math.min(Math.max(w,p),m))))/2,b=y,d=w,p=[],m=(f&&(0,m=(g=getAdjustedSizes({aspectRatio:g,width:m=o,height:f=n},{contain:"cover",cover:"contain"}[l.resize])).width,f=g.height,p.push((o-m)/2,(n-f)/2,m,f)),p.push(v,E,b,d),h&&(y=(g=[w,y])[0],w=g[1]),c.width=y,c.height=w,isImageType(l.mimeType)||(l.mimeType=i.type),"transparent"),R=(i.size>l.convertSize&&0<=l.convertTypes.indexOf(l.mimeType)&&(l.mimeType="image/jpeg"),"image/jpeg"===l.mimeType);u.fillStyle=m=R?"#fff":m,u.fillRect(0,0,y,w),l.beforeDraw&&l.beforeDraw.call(this,u,c),this.aborted||(u.save(),u.translate(y/2,w/2),u.rotate(t*Math.PI/180),u.scale(r,e),u.drawImage.apply(u,[s].concat(p)),u.restore(),l.drew&&l.drew.call(this,u,c),this.aborted||(f=function(e){var t,r,i;a.aborted||(t=function(e){return a.done({naturalWidth:o,naturalHeight:n,result:e})},e&&R&&l.retainExif&&a.exif&&0<a.exif.length?(r=function(e){return t(toBlob(arrayBufferToDataURL(insertExif(e,a.exif),l.mimeType)))},e.arrayBuffer?e.arrayBuffer().then(r).catch(function(){a.fail(new Error("Failed to read the compressed image with Blob.arrayBuffer()."))}):(i=new FileReader,(a.reader=i).onload=function(e){e=e.target;r(e.result)},i.onabort=function(){a.fail(new Error("Aborted to read the compressed image with FileReader."))},i.onerror=function(){a.fail(new Error("Failed to read the compressed image with FileReader."))},i.onloadend=function(){a.reader=null},i.readAsArrayBuffer(e))):t(e))},c.toBlob?c.toBlob(f,l.mimeType,l.quality):f(toBlob(c.toDataURL(l.mimeType,l.quality)))))}},{key:"done",value:function(e){var t=e.naturalWidth,r=e.naturalHeight,e=e.result,i=this.file,a=this.image,o=this.options;URL&&0===a.src.indexOf("blob:")&&URL.revokeObjectURL(a.src),!e||o.strict&&!o.retainExif&&e.size>i.size&&o.mimeType===i.type&&!(o.width>t||o.height>r||o.minWidth>t||o.minHeight>r||o.maxWidth<t||o.maxHeight<r)?e=i:(a=new Date,e.lastModified=a.getTime(),e.lastModifiedDate=a,e.name=i.name,e.name&&e.type!==i.type&&(e.name=e.name.replace(REGEXP_EXTENSION,imageTypeToExtension(e.type)))),this.result=e,o.success&&o.success.call(this,e)}},{key:"fail",value:function(e){var t=this.options;if(!t.error)throw e;t.error.call(this,e)}},{key:"abort",value:function(){this.aborted||(this.aborted=!0,this.reader?this.reader.abort():this.image.complete?this.fail(new Error("The compression process has been aborted.")):(this.image.onload=null,this.image.onabort()))}}],[{key:"noConflict",value:function(){return window.Compressor=AnotherCompressor,r}},{key:"setDefaults",value:function(e){_extends(DEFAULTS,e)}}]),r}();export{Compressor as default};